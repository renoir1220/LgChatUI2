@import "tailwindcss";

/* Reset template constraints and set sensible defaults */
html, body, #root {
  height: 100%;
  /* 不强制使用 100vh/100dvh，避免 iOS 地址栏/工具栏带来的计算误差 */
  /* 由页面主容器自适应 svh/dvh，键盘弹出时更稳定 */
  margin: 0;
  padding: 0;
  /* 防止 iOS 橡皮筋滚动干扰内部滚动区域 */
  overscroll-behavior: none;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: rgb(248, 250, 252);
}

/* 主聊天容器：使用动态/小视口单位并提供回退，避免 100vh 在 iOS 的问题 */
.chat-container {
  width: 100%;
  height: 100%;
  min-height: 100svh;
  min-height: 100dvh;
  /* 避免出现页面双滚动条，内部列表自滚动 */
  overflow: hidden;
  box-sizing: border-box;
}

/* Prefer matching system theme; UI tokens come from Tailwind */
:root {
  color-scheme: light dark;
}

/* 自定义滚动条样式 */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(156, 163, 175, 0.3);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(156, 163, 175, 0.5);
}

/* iOS PWA全屏模式样式调整 - 优化版本 */
@media (display-mode: standalone) {
  /* iOS PWA独立模式下的根容器适配 */
  html { height: 100%; }
  
  body {
    height: 100%;
    /* 防止过度滚动导致的橡皮筋效果 */
    overscroll-behavior-y: none;
    /* 移除默认的body边距，使用安全区域内边距 */
    margin: 0;
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }
  
  /* 根容器填满可用高度 */
  #root {
    height: 100%;
    min-height: 100%;
    /* 确保在安全区域内显示内容 */
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
  }

  /* 独立模式下，确保主容器占满可视高度 */
  .chat-container {
    min-height: 100dvh;
  }
}

/* 非PWA模式下的备用样式 */
@media (display-mode: browser) {
  html, body, #root {
    height: 100%;
  }
}

/* 通用iOS设备安全区域支持 */
@supports (padding: max(0px)) {
  /* 仅在支持安全区域的设备上应用 */
  @media (display-mode: standalone) {
    /* 状态栏区域适配 */
    body {
      padding-top: max(env(safe-area-inset-top), 0px);
      padding-bottom: max(env(safe-area-inset-bottom), 0px);
      padding-left: max(env(safe-area-inset-left), 0px);
      padding-right: max(env(safe-area-inset-right), 0px);
    }
  }
}

/* iOS特定的视口高度修复 */
@supports (-webkit-touch-callout: none) {
  /* 修复iOS中100vh包含地址栏的问题 */
  html { height: -webkit-fill-available; }
  body { min-height: -webkit-fill-available; }
  /* 为聊天界面提供额外的iOS适配（采用最小高度而非固定高度） */
  .chat-container { min-height: -webkit-fill-available; }
}

/* 动态视口单位支持检测和备用方案 */
@supports not (height: 100dvh) {
  /* 对于不支持动态视口单位的旧版本iOS */
  html, body, #root { min-height: 100vh; }
  
  @media (display-mode: standalone) {
    html, body { min-height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom)); }
  }
}
