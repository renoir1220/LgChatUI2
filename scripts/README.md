# Releaseè„šæœ¬ä½¿ç”¨æŒ‡å—

æœ¬ç›®å½•åŒ…å«äº† LgChatUI2 é¡¹ç›®çš„å®Œæ•´å‘å¸ƒå’Œéƒ¨ç½²è„šæœ¬ï¼Œæ”¯æŒå°å›¢é˜Ÿå¿«é€Ÿè¿­ä»£å’Œä¸€é”®éƒ¨ç½²ã€‚

## ğŸ“ è„šæœ¬æ¦‚è§ˆ

| è„šæœ¬æ–‡ä»¶ | åŠŸèƒ½æè¿° | ä¸»è¦ç”¨é€” |
|---------|---------|---------|
| `version.js` | æ™ºèƒ½ç‰ˆæœ¬ç®¡ç† | è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬ç±»å‹ã€æ›´æ–°ç‰ˆæœ¬å·ã€ç”Ÿæˆå˜æ›´æ—¥å¿— |
| `build.js` | è‡ªåŠ¨åŒ–æ„å»º | æ¸…ç†ã€æ£€æŸ¥ã€æ„å»ºã€æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒä»£ç  |
| `deploy.js` | Dockeréƒ¨ç½² | ä¸€é”®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œæ”¯æŒå¤‡ä»½å›æ»š |
| `health-check.js` | å¥åº·ç›‘æ§ | æœåŠ¡çŠ¶æ€æ£€æŸ¥ã€ç³»ç»Ÿç›‘æ§ã€è‡ªåŠ¨é‡å¯ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®Œæ•´å‘å¸ƒæµç¨‹ï¼ˆæ¨èï¼‰

```bash
# ä¸€é”®å®Œæˆç‰ˆæœ¬ã€æ„å»ºã€éƒ¨ç½²å…¨æµç¨‹
npm run release:full
```

è¿™ä¸ªå‘½ä»¤ä¼šä¾æ¬¡æ‰§è¡Œï¼š
1. è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬ç±»å‹å¹¶åˆ›å»ºæ–°ç‰ˆæœ¬
2. æ„å»ºç”Ÿäº§ç¯å¢ƒä»£ç 
3. éƒ¨ç½²åˆ°Dockerå®¹å™¨

### åˆ†æ­¥æ‰§è¡Œæµç¨‹

å¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥åˆ†æ­¥æ‰§è¡Œï¼š

```bash
# 1. åˆ›å»ºæ–°ç‰ˆæœ¬
npm run version release [type]

# 2. æ„å»ºç”Ÿäº§ä»£ç 
npm run release:build

# 3. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
npm run release:deploy [environment]

# 4. å¥åº·æ£€æŸ¥
npm run health:check
```

## ğŸ“‹ è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. ç‰ˆæœ¬ç®¡ç† (`version.js`)

**åŸºç¡€ç”¨æ³•ï¼š**
```bash
# è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬ç±»å‹ï¼ˆæ ¹æ®gitæäº¤ä¿¡æ¯ï¼‰
npm run version release

# æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬ç±»å‹
npm run version release patch    # è¡¥ä¸ç‰ˆæœ¬ (1.0.0 -> 1.0.1)
npm run version release minor    # åŠŸèƒ½ç‰ˆæœ¬ (1.0.0 -> 1.1.0)
npm run version release major    # ä¸»è¦ç‰ˆæœ¬ (1.0.0 -> 2.0.0)

# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
npm run version current
```

**è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹è§„åˆ™ï¼š**
- åŒ…å« `BREAKING CHANGE` æˆ– `feat!` â†’ majorç‰ˆæœ¬
- åŒ…å« `feat(` â†’ minorç‰ˆæœ¬
- å…¶ä»–æƒ…å†µ â†’ patchç‰ˆæœ¬

**æ‰§è¡Œå†…å®¹ï¼š**
- âœ… æ›´æ–°æ‰€æœ‰workspaceçš„package.jsonç‰ˆæœ¬å·
- âœ… ç”Ÿæˆ/æ›´æ–° CHANGELOG.md
- âœ… åˆ›å»ºgitæäº¤å’Œæ ‡ç­¾
- âœ… å‡†å¤‡å‘å¸ƒè¯´æ˜

### 2. æ„å»ºç³»ç»Ÿ (`build.js`)

**åŸºç¡€ç”¨æ³•ï¼š**
```bash
npm run release:build
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ğŸ§¹ æ¸…ç†æ—§çš„æ„å»ºäº§ç‰©
2. ğŸ” é¢„æ„å»ºæ£€æŸ¥ï¼ˆä¾èµ–ã€ç±»å‹æ£€æŸ¥ã€ä»£ç æ£€æŸ¥ï¼‰
3. ğŸ“¦ æ„å»ºå…±äº«åŒ… (@lg/shared)
4. ğŸ”„ å¹¶è¡Œæ„å»ºå‰åç«¯
5. âœ… éªŒè¯æ„å»ºç»“æœ
6. ğŸ“¦ åˆ›å»ºç»Ÿä¸€å‘å¸ƒåŒ… (`dist/` ç›®å½•)
7. ğŸ“Š ç”Ÿæˆæ„å»ºæŠ¥å‘Š

**æ„å»ºäº§ç‰©ï¼š**
```
dist/
â”œâ”€â”€ backend/           # åç«¯æ„å»ºäº§ç‰©
â”œâ”€â”€ frontend/          # å‰ç«¯æ„å»ºäº§ç‰©
â”œâ”€â”€ package.json       # æ ¹é…ç½®æ–‡ä»¶
â”œâ”€â”€ backend/package.json # åç«¯é…ç½®æ–‡ä»¶
â””â”€â”€ build-report.json  # æ„å»ºæŠ¥å‘Š
```

### 3. Dockeréƒ¨ç½² (`deploy.js`)

**åŸºç¡€ç”¨æ³•ï¼š**
```bash
# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
npm run release:deploy

# éƒ¨ç½²åˆ°æŒ‡å®šç¯å¢ƒ
npm run release:deploy production
npm run release:deploy staging
```

**éƒ¨ç½²æµç¨‹ï¼š**
1. ğŸ” éƒ¨ç½²å‰æ£€æŸ¥ï¼ˆæ„å»ºäº§ç‰©ã€ç¯å¢ƒé…ç½®ï¼‰
2. ğŸ’¾ åˆ›å»ºDockeré•œåƒå¤‡ä»½
3. ğŸ”¨ æ„å»ºæ–°çš„Dockeré•œåƒ
4. ğŸ›‘ åœæ­¢æ—§å®¹å™¨
5. ğŸš€ å¯åŠ¨æ–°å®¹å™¨
6. â³ ç­‰å¾…æœåŠ¡å¯åŠ¨
7. ğŸ” å¥åº·æ£€æŸ¥éªŒè¯
8. ğŸ”„ å¤±è´¥è‡ªåŠ¨å›æ»š

**DockeræœåŠ¡ï¼š**
- `lgchatui2-app`: ä¸»åº”ç”¨å®¹å™¨ï¼ˆNode.jsåç«¯ + å‰ç«¯èµ„æºï¼‰
- `lgchatui2-nginx`: Nginxåå‘ä»£ç†å®¹å™¨

**ç«¯å£æ˜ å°„ï¼š**
- `80`: Nginx HTTPå…¥å£
- `3000`: åº”ç”¨æœåŠ¡ç«¯å£ï¼ˆå®¹å™¨å†…éƒ¨ï¼‰

### 4. å¥åº·ç›‘æ§ (`health-check.js`)

**åŸºç¡€ç”¨æ³•ï¼š**
```bash
# å•æ¬¡å¥åº·æ£€æŸ¥
npm run health:check

# æŒç»­ç›‘æ§ï¼ˆæ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰
npm run health:monitor
```

**æ£€æŸ¥é¡¹ç›®ï¼š**
- ğŸ³ Dockerå®¹å™¨çŠ¶æ€
- ğŸŒ HTTPæœåŠ¡å“åº”
- ğŸ’» ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ï¼ˆå†…å­˜ã€ç£ç›˜ã€CPUï¼‰
- ğŸ“‹ é”™è¯¯æ—¥å¿—ç»Ÿè®¡

**è‡ªåŠ¨å¤„ç†ï¼š**
- è¿ç»­3æ¬¡å¤±è´¥ â†’ è‡ªåŠ¨é‡å¯æœåŠ¡
- é‡å¯å¤±è´¥ â†’ è®°å½•å‘Šè­¦æ—¥å¿—
- èµ„æºè¶…é™ â†’ å‘å‡ºè­¦å‘Š

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒé…ç½®

éƒ¨ç½²é…ç½®ä½äº `deploy.js` ä¸­çš„ `deployConfig`ï¼Œä¸»è¦é…ç½®é¡¹ï¼š

```javascript
{
  environments: {
    production: {
      deployMethod: 'docker',
      docker: {
        composeFile: 'docker-compose.prod.yml',
        serviceName: 'lgchatui2'
      },
      healthCheck: {
        url: 'http://localhost:3000/health',
        retries: 5
      }
    }
  }
}
```

### Dockeré…ç½®æ–‡ä»¶

- `Dockerfile`: å¤šé˜¶æ®µæ„å»ºï¼Œä¼˜åŒ–é•œåƒå¤§å°
- `docker-compose.prod.yml`: ç”Ÿäº§ç¯å¢ƒå®¹å™¨ç¼–æ’
- `nginx/`: Nginxé…ç½®æ–‡ä»¶

## ğŸš¨ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**1. ç‰ˆæœ¬å‘å¸ƒå¤±è´¥**
```bash
# æ£€æŸ¥gitçŠ¶æ€
git status

# ç¡®ä¿å·¥ä½œåŒºå¹²å‡€
git add . && git commit -m "fix: ä¿®å¤é—®é¢˜"

# é‡æ–°æ‰§è¡Œç‰ˆæœ¬å‘å¸ƒ
npm run version release
```

**2. æ„å»ºå¤±è´¥**
```bash
# æ£€æŸ¥ç±»å‹é”™è¯¯
npm run typecheck

# æ£€æŸ¥ä»£ç é£æ ¼
npm run lint

# æ¸…ç†åé‡æ–°æ„å»º
npm run clean && npm run release:build
```

**3. éƒ¨ç½²å¤±è´¥**
```bash
# æ£€æŸ¥DockerçŠ¶æ€
docker ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs lgchatui2-app

# æ‰‹åŠ¨é‡å¯æœåŠ¡
docker-compose -f docker-compose.prod.yml restart
```

**4. æœåŠ¡å¼‚å¸¸**
```bash
# å¥åº·æ£€æŸ¥
npm run health:check

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker logs lgchatui2-app -f

# å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰å¤‡ä»½ï¼‰
docker tag lgchatui2:backup-[timestamp] lgchatui2:latest
docker-compose -f docker-compose.prod.yml up -d
```

### æ—¥å¿—æ–‡ä»¶ä½ç½®

- åº”ç”¨æ—¥å¿—: `./logs/`
- Nginxæ—¥å¿—: `./logs/nginx/`
- å‘Šè­¦æ—¥å¿—: `./logs/alerts.log`
- æ„å»ºæŠ¥å‘Š: `./dist/build-report.json`

## ğŸ“ˆ æœ€ä½³å®è·µ

### å‘å¸ƒæµç¨‹å»ºè®®

1. **å¼€å‘å®Œæˆå**ï¼š
   ```bash
   # ç¡®ä¿ä»£ç è´¨é‡
   npm run lint && npm run typecheck
   
   # æµ‹è¯•åŠŸèƒ½
   npm run test
   ```

2. **å‡†å¤‡å‘å¸ƒ**ï¼š
   ```bash
   # æäº¤æ‰€æœ‰å˜æ›´
   git add . && git commit -m "feat: æ–°åŠŸèƒ½å®ç°"
   
   # ä¸€é”®å‘å¸ƒ
   npm run release:full
   ```

3. **å‘å¸ƒåéªŒè¯**ï¼š
   ```bash
   # å¥åº·æ£€æŸ¥
   npm run health:check
   
   # åŠŸèƒ½éªŒè¯
   curl http://localhost/api/health
   ```

### ç‰ˆæœ¬å‘½åè§„èŒƒ

éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ (Semantic Versioning)ï¼š

- **MAJOR**: ä¸å…¼å®¹çš„APIå˜æ›´
- **MINOR**: å‘åå…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **PATCH**: å‘åå…¼å®¹çš„é—®é¢˜ä¿®æ­£

### Gitæäº¤è§„èŒƒ

å»ºè®®ä½¿ç”¨ Conventional Commits è§„èŒƒï¼š

```bash
# æ–°åŠŸèƒ½
git commit -m "feat(chat): æ·»åŠ è¯­éŸ³æ¶ˆæ¯åŠŸèƒ½"

# é—®é¢˜ä¿®å¤
git commit -m "fix(auth): ä¿®å¤ç™»å½•tokenè¿‡æœŸé—®é¢˜"

# ç ´åæ€§å˜æ›´
git commit -m "feat!: é‡æ„APIæ¥å£ç»“æ„"
```

## ğŸ†˜ ç´§æ€¥å¤„ç†

### å¿«é€Ÿå›æ»š

å¦‚æœéƒ¨ç½²åå‘ç°ä¸¥é‡é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
# 1. åœæ­¢å½“å‰æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# 2. æŸ¥çœ‹å¯ç”¨çš„å¤‡ä»½é•œåƒ
docker images | grep backup

# 3. å›æ»šåˆ°æŒ‡å®šå¤‡ä»½
docker tag lgchatui2:backup-[timestamp] lgchatui2:latest

# 4. é‡æ–°å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# 5. éªŒè¯å›æ»šç»“æœ
npm run health:check
```

### æ•°æ®å¤‡ä»½

é‡è¦æé†’ï¼šè„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½Dockeré•œåƒï¼Œä½†æ•°æ®åº“æ•°æ®éœ€è¦å•ç‹¬å¤‡ä»½ï¼š

```bash
# æ•°æ®åº“å¤‡ä»½ï¼ˆæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰
# å› ä¸ºä½¿ç”¨å¤–éƒ¨MSSQLï¼Œå»ºè®®é…ç½®å®šæœŸå¤‡ä»½ç­–ç•¥
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°è„šæœ¬ç›¸å…³é—®é¢˜ï¼š

1. æŸ¥çœ‹è„šæœ¬è¾“å‡ºçš„è¯¦ç»†æ—¥å¿—
2. æ£€æŸ¥ `./logs/` ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶
3. å‚è€ƒæœ¬æ–‡æ¡£çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
4. æŸ¥çœ‹é¡¹ç›®çš„ CLAUDE.md æ–‡æ¡£

**è®°ä½ï¼šå°å›¢é˜Ÿçš„ä¼˜åŠ¿åœ¨äºå¿«é€Ÿè¿­ä»£ï¼Œè¿™å¥—è„šæœ¬æ—¨åœ¨è®©å‘å¸ƒè¿‡ç¨‹å˜å¾—ç®€å•å¯é ï¼** ğŸš€