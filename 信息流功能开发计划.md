# 信息流功能开发计划

## 项目概述

在右上角现有灯泡图标位置添加信息流功能，类似 Perplexity 的信息流设计，参考知乎的页面展示形式。

## 功能特性

### 信息流分类
- 所有
- 与我有关  
- 新闻
- 新功能
- 新知识

### 核心功能
- 信息流列表展示（支持缩略图或占位符）
- 信息详情页面（支持正文展示）
- 用户评论系统（支持回复和点赞）
- 响应式设计（PC端和移动端兼容）

### 数据来源
- 人工添加（如新闻内容）
- 定时服务自动采集

## 第一阶段开发计划

### 阶段目标
完成信息流基础功能的后端API、数据库设计、前端界面实现，并生成模拟数据进行展示。

### 开发任务

#### 1. 数据库设计
**文件位置**: `sql/`

##### 表结构设计
- **AI_InfoFeed** - 信息流主表
  - id (主键)
  - title (标题)
  - content (正文内容，支持富文本)
  - summary (摘要)
  - category (分类：all/related/news/features/knowledge)
  - thumbnail_url (缩略图URL)
  - source (来源：manual/auto)
  - author_id (作者ID，关联用户表)
  - view_count (浏览次数)
  - like_count (点赞次数)
  - comment_count (评论次数)
  - is_pinned (是否置顶)
  - status (状态：draft/published/archived)
  - publish_time (发布时间)
  - created_at (创建时间)
  - updated_at (更新时间)

- **AI_InfoFeedComment** - 信息流评论表
  - id (主键)
  - feed_id (信息流ID，外键)
  - user_id (用户ID，外键)
  - parent_id (父评论ID，用于回复功能)
  - content (评论内容)
  - like_count (点赞次数)
  - created_at (创建时间)
  - updated_at (更新时间)

- **AI_InfoFeedLike** - 信息流点赞表
  - id (主键)
  - feed_id (信息流ID，外键，可为null)
  - comment_id (评论ID，外键，可为null)
  - user_id (用户ID，外键)
  - created_at (创建时间)

##### 脚本文件
- `sql/01_create_infofeed_tables.sql` - 创建表结构
- `sql/02_insert_infofeed_mock_data.sql` - 插入测试数据

#### 2. 后端API开发
**文件位置**: `backend/src/features/infofeed/`

##### API端点设计
- `GET /api/infofeed` - 获取信息流列表（支持分类筛选、分页）
- `GET /api/infofeed/:id` - 获取信息流详情
- `POST /api/infofeed/:id/like` - 点赞/取消点赞信息流
- `GET /api/infofeed/:id/comments` - 获取信息流评论列表
- `POST /api/infofeed/:id/comments` - 添加评论
- `POST /api/infofeed/comments/:id/like` - 点赞/取消点赞评论
- `POST /api/infofeed/comments/:id/reply` - 回复评论

##### 模块文件
- `infofeed.controller.ts` - 控制器
- `infofeed.service.ts` - 业务逻辑服务
- `infofeed.module.ts` - 模块定义
- `dto/` - 数据传输对象定义
- `entities/` - 数据库实体定义

#### 3. 前端界面开发
**文件位置**: `frontend/src/features/infofeed/`

##### 组件设计
- **InfoFeedIcon** - 信息流图标组件（替换原灯泡图标）
- **InfoFeedModal** - 信息流弹窗主容器
- **InfoFeedList** - 信息流列表组件
- **InfoFeedItem** - 信息流列表项组件
- **InfoFeedDetail** - 信息流详情页面
- **InfoFeedComments** - 评论组件
- **CategoryTabs** - 分类标签页组件

##### 响应式设计
- 移动端：全屏弹窗展示
- PC端：右侧弹出式面板
- 使用 TailwindCSS 实现响应式布局

##### 状态管理
- 使用 React Context 或 zustand 管理信息流状态
- 管理分类切换、评论状态、点赞状态等

#### 4. 集成和测试
- 替换头部右上角灯泡图标为信息流入口
- 生成丰富的模拟数据（包含不同分类、有图/无图内容）
- 测试响应式布局在不同设备上的表现
- 验证评论和点赞功能

## 技术实现细节

### 缩略图处理
- 解析正文内容中的第一张图片作为缩略图
- 无图片时使用分类对应的默认占位符
- 支持外部图片URL和本地上传图片

### 富文本支持
- 正文内容支持Markdown格式
- 前端使用markdown渲染器展示
- 支持图片、链接等富媒体内容

### 性能优化
- 信息流列表实现虚拟滚动
- 图片懒加载
- 评论分页加载
- 合理的缓存策略

### 数据库索引
- category字段索引（分类筛选）
- publish_time字段索引（时间排序）
- user_id字段索引（个人相关内容）
- 复合索引优化查询性能

## 产出文件清单

### 数据库脚本
- `sql/01_create_infofeed_tables.sql`
- `sql/02_insert_infofeed_mock_data.sql`

### 后端文件
- `backend/src/features/infofeed/infofeed.module.ts`
- `backend/src/features/infofeed/infofeed.controller.ts`
- `backend/src/features/infofeed/infofeed.service.ts`
- `backend/src/features/infofeed/dto/`
- `backend/src/features/infofeed/entities/`

### 前端文件
- `frontend/src/features/infofeed/components/`
- `frontend/src/features/infofeed/hooks/`
- `frontend/src/features/infofeed/types/`
- `frontend/src/features/infofeed/api/`

### 类型定义
- `backend/src/types/infofeed.types.ts`
- `frontend/src/types/infofeed.types.ts`

## 时间估算

- 数据库设计和脚本：0.5天
- 后端API开发：1.5天
- 前端组件开发：2天
- 响应式优化和集成：1天
- 测试数据和调试：0.5天

**总计：约5.5天**

## 验收标准

1. ✅ 数据库表结构创建成功，包含完整的测试数据
2. ✅ 后端API全部实现并可正常调用
3. ✅ 前端信息流界面完整实现，替换原有灯泡图标
4. ✅ 支持PC端和移动端响应式展示
5. ✅ 信息流列表、详情、评论功能正常工作
6. ✅ 缩略图和占位符正确显示
7. ✅ 分类筛选功能正常
8. ✅ 包含丰富的模拟数据供展示

---

**计划创建时间**：2025-08-26  
**计划执行者**：开发团队  
**下一步**：等待第一阶段完成后，讨论后续功能迭代计划