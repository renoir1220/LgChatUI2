# AI消息反馈功能设计方案

## 功能概述

为LgChatUI2聊天系统增加用户对AI返回结果的反馈功能，收集用户对AI回答质量的评价，用于后续的系统优化和知识库改进。

## 核心需求

### 1. 反馈类型设计

**基础反馈类型**
- 👍 **有用 (Helpful)**: 回答准确、有价值、解决了问题
- 👎 **无用 (Not Helpful)**: 回答不准确、无关或质量差
- 🎯 **部分有用 (Partially Helpful)**: 有一定价值但不完全满足需求

**扩展评价维度**
- ✅ **准确性**: 事实和信息是否正确
- 📝 **完整性**: 回答是否完整全面
- 💡 **实用性**: 是否解决了实际问题
- 📚 **相关性**: 回答内容是否切题
- 🔗 **知识源质量**: 引用的资料是否相关准确

### 2. 用户交互设计

**快速反馈模式**
- 在每条AI消息下方显示简洁的反馈工具栏
- 包含快速反馈按钮：👍、👎
- 与现有功能（复制、重新生成）整合在同一工具栏

**详细反馈模式**
- 点击"反馈"按钮打开详细反馈弹窗
- 支持选择具体问题类型（多选标签）
- 可输入文字说明具体问题或建议
- 可选择1-5星评分

**反馈状态显示**
- 显示用户已提交的反馈状态
- 支持修改已提交的反馈
- 显示该消息的整体反馈统计（管理员可见）

### 3. 反馈标签体系

**问题类型标签**
- 🚫 **事实错误**: 包含不准确的信息
- ❓ **信息不完整**: 回答不够详细
- 🔄 **无关回答**: 答非所问
- 📖 **知识源问题**: 引用资料不相关
- 🤖 **理解错误**: AI误解了问题意图
- ⚡ **响应速度**: 回答太慢或太快
- 📝 **格式问题**: 排版或格式不佳

**优点标签**
- ✨ **准确详细**: 信息准确且详细
- 🎯 **切中要害**: 直接解决问题
- 📚 **资料丰富**: 提供了有价值的参考资料
- 💡 **举一反三**: 提供了额外的相关信息
- 🔗 **逻辑清晰**: 回答结构清晰易懂

## 功能架构设计

### 1. 数据存储设计

**核心实体: AI_MESSAGE_FEEDBACK**
- 反馈ID (主键)
- 消息ID (关联AI_MESSAGES)
- 用户ID (CRM_USER_ID)
- 会话ID (关联AI_CONVERSATIONS)
- 反馈类型 (helpful/not_helpful/partially_helpful)
- 评分 (1-5星，可选)
- 反馈文本 (详细说明，可选)
- 反馈标签 (JSON数组)
- 创建时间、更新时间

**数据约束**
- 每个用户对每条消息只能有一条反馈记录
- 使用复合唯一索引确保数据完整性
- 支持软删除，保留历史数据

### 2. 权限控制设计

**用户权限**
- 用户只能对自己参与的会话中的AI消息提供反馈
- 用户可以查看和修改自己的反馈
- 用户无法查看其他人的反馈

**管理员权限**
- 查看所有反馈数据和统计
- 导出反馈数据用于分析
- 查看反馈趋势和质量报告

### 3. API接口设计

**反馈提交接口**
```
POST /api/messages/{messageId}/feedback
- 提交或更新消息反馈
- 支持增量更新（只更新变更字段）
```

**反馈查询接口**
```
GET /api/messages/{messageId}/feedback
- 获取当前用户对该消息的反馈
```

**反馈统计接口**
```
GET /api/admin/feedback/stats
- 管理员查看反馈统计数据
- 支持按时间、知识库、反馈类型筛选
```

## 业务价值与应用场景

### 1. 直接价值

**用户体验改进**
- 让用户有表达满意度的渠道
- 增强用户对系统的参与感
- 提供问题反馈的便捷途径

**系统质量提升**
- 识别AI回答的常见问题
- 定位知识库的薄弱环节
- 为系统优化提供数据支撑

### 2. 数据分析应用

**质量监控**
- 实时监控AI回答质量趋势
- 识别质量下降的时间点和原因
- 按知识库分析质量差异

**内容优化**
- 识别经常被标记为"无用"的问题类型
- 发现知识库内容缺失的领域
- 优化知识库文档质量

**用户行为分析**
- 分析用户对不同类型回答的偏好
- 识别用户最关心的问题领域
- 优化问答策略

### 3. 业务决策支持

**知识库投入决策**
- 哪些知识库需要重点投入
- 哪些领域的内容需要补充
- 哪些类型的问题需要专门优化

**AI配置优化**
- 调整AI模型参数
- 优化知识库检索策略
- 改进回答生成逻辑

## 实施策略

### Phase 1: 基础反馈功能 (MVP)
**目标**: 快速上线基本反馈能力
**功能范围**:
- 简单的👍👎反馈按钮
- 基础数据存储和API
- 反馈状态显示

**成功指标**:
- 用户反馈参与率 > 10%
- 反馈数据收集稳定运行

### Phase 2: 增强用户体验
**目标**: 提升反馈质量和用户参与度
**功能范围**:
- 详细反馈弹窗和标签系统
- 反馈修改功能
- 反馈统计基础展示

**成功指标**:
- 详细反馈比例 > 30%
- 用户反馈修改率 < 5%

### Phase 3: 数据分析与优化
**目标**: 将反馈数据转化为业务价值
**功能范围**:
- 管理员反馈分析面板
- 反馈趋势分析和报告
- 基于反馈的系统优化建议

**成功指标**:
- 基于反馈完成至少3项系统优化
- AI回答满意度提升10%

## 风险考虑与应对

### 1. 用户参与度风险
**风险**: 用户不愿意提供反馈
**应对**:
- 简化反馈流程，降低参与门槛
- 在关键节点引导用户提供反馈
- 考虑适当的激励机制

### 2. 数据质量风险
**风险**: 反馈数据不准确或有偏见
**应对**:
- 设计合理的反馈选项避免引导性
- 收集足够样本量确保统计有效性
- 结合多维度数据进行综合分析

### 3. 隐私保护风险
**风险**: 反馈数据可能泄露用户对话内容
**应对**:
- 反馈数据与对话内容分离存储
- 严格的数据访问权限控制
- 定期清理敏感反馈数据

## 成功指标定义

### 1. 参与指标
- **反馈参与率**: 有反馈的AI消息 / 总AI消息数
- **详细反馈率**: 包含文字说明的反馈 / 总反馈数
- **用户活跃度**: 提供反馈的用户数 / 总活跃用户数

### 2. 质量指标
- **正面反馈率**: 👍反馈 / 总反馈数
- **问题识别率**: 标记具体问题的反馈数
- **改进效果**: 基于反馈优化后的满意度提升

### 3. 业务价值指标
- **问题解决率**: 基于反馈发现并解决的问题数
- **系统优化数**: 基于反馈数据完成的系统改进数
- **用户满意度**: 整体用户满意度调研结果

---

**文档状态**: 设计完成，待实施
**创建时间**: 2025-09-18
**责任人**: 产品/开发团队
**优先级**: 中等（用户体验增强功能）